import{d as A,ah as $,aC as z,b as E,r as f,t as a,i as L,j as D,k as c,m as y,l as e,v as l,A as n,ay as F,J as I,K,L as V,N as j,E as w,M as x,az as G,ae as J,a1 as g,B as O}from"./index-a68aaa53.js";import{N as T,b as v}from"./Grid-9f47effa.js";import{a as H}from"./FormItem-b30e1ec3.js";const Q={class:"border-none shadow-none flex flex-col gap-2 p-2 rounded-lg"},W={class:"post-heading mb-1"},X={class:"gtext text-2xl font-bold underlined"},Y={style:{display:"flex","justify-content":"flex-end"}},Z="University",P="research",ie=A({__name:"AddUniversity",setup(ee){const m=$(),N=z(),p=E(),U=f(null),u=f(!1),t=f(m.initState()),C={name:[{required:!0,message:a("university.nameRequired"),trigger:["input","blur"]}],country:[{required:!0,message:a("university.countryRequired")}],image:[{required:!0,message:a("university.imageRequired"),trigger:["input","blur"]}]};async function k(){try{u.value=!0,await m.insertUniversityAction(t.value),u.value=!1,m.showModelAdd=!1,p.success(a("common.addSuccess"))}catch(r){u.value=!1,console.error(a("common.addFailed"),r.message),p.error(a("common.addFailed"),r.message)}}const S=async({file:r,data:s,headers:i,withCredentials:ae,action:te,onFinish:_,onError:M,onProgress:b})=>{try{if(!s)throw new Error("dataParams is undefined");const o={loaded:20,total:100},R=Math.round(o.loaded*100/o.total);b({percent:R});const{data:h,error:d}=await J.storage.from(s.bucket).upload(`${s.folder}/${r.name}`,r.file,{cacheControl:"3600",upsert:!1});if(b({percent:Math.ceil(10)}),d)if(d.statusCode==="409"&&d.error==="Duplicate")t.value.image_url=`${s.folder}/${r.name}`,_();else throw d;h&&(t.value.image_url=h.path,_())}catch(o){console.log(o),p.error(o.message),M()}};function q(){return!t.value.name||!t.value.country_code||!t.value.image_url}const B=r=>g("div",{style:{display:"flex",alignItems:"center"}},[g(O,{icon:"flagpack:"+(typeof r.value=="string"?r.value.toLowerCase():r.value),class:"w-6 h-6"}),g("span",{style:{marginLeft:"8px"}},r.label)]);return(r,s)=>(L(),D("div",Q,[c("div",W,[c("div",X,y(e(a)("university.addUniversity")),1)]),l(e(H),{ref_key:"formRef",ref:U,model:t.value,rules:C,size:"large"},{default:n(()=>[c("div",null,[l(e(T),{cols:4,span:24,"x-gap":24},{default:n(()=>[l(e(v),{span:12,path:"image",label:e(a)("university.image")},{default:n(()=>[l(e(F),{accept:"image/*","list-type":"image-card",max:1,path:"image",data:{folder:Z,bucket:P},"custom-request":S},null,8,["data"])]),_:1},8,["label"]),l(e(v),{span:12,path:"name",label:e(a)("university.universityName")},{default:n(()=>[l(e(I),{value:t.value.name,"onUpdate:value":s[0]||(s[0]=i=>t.value.name=i),placeholder:e(a)("university.universityName"),clearable:"",onKeydown:s[1]||(s[1]=K(V(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["label"]),l(e(v),{span:12,path:"country",label:e(a)("university.country")},{default:n(()=>[l(e(j),{filterable:"",trigger:"hover",value:t.value.country_code,"onUpdate:value":s[2]||(s[2]=i=>t.value.country_code=i),options:e(N).getCountryOption(),"render-label":B},{default:n(()=>[l(e(w),null,{default:n(()=>[x(y(e(a)("university.country")),1)]),_:1})]),_:1},8,["value","options"])]),_:1},8,["label"]),l(e(v),{span:12,path:"state",label:e(a)("university.state")},{default:n(()=>[l(e(G),{value:t.value.is_active,"onUpdate:value":s[3]||(s[3]=i=>t.value.is_active=i),size:"large"},null,8,["value"])]),_:1},8,["label"])]),_:1})]),c("div",Y,[l(e(w),{type:"primary",style:{width:"100%"},size:"large",loading:u.value,disabled:q(),onClick:k},{default:n(()=>[x(y(e(a)("university.addUniversity")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])]))}});export{ie as _};
